<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Tiraggo.edmx by BrewDawg</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/BrewDawg/Tiraggo.Edmx">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/BrewDawg/Tiraggo.Edmx/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/BrewDawg/Tiraggo.Edmx/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Tiraggo.edmx</h1>
          <p>Full EDMX Metadata Served up with low level SQL Metadata</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/BrewDawg">BrewDawg</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h2>
<a name="an-awesome-way-to-access-your-edmx-file-metadata" class="anchor" href="#an-awesome-way-to-access-your-edmx-file-metadata"><span class="octicon octicon-link"></span></a>An Awesome way to Access your EDMX file Metadata</h2>

<p>Copyright Â© Mike Griffin 2013 (<a href="http://www.tiraggo.com">http://www.tiraggo.com</a>)</p>

<p>License: <a href="https://raw.github.com/BrewDawg/Tiraggo.Edmx/master/License.txt">Microsoft Reciprocal License (Ms-RL)</a></p>

<p><a href="http://www.nuget.org/packages/Tiraggo.Edmx/">NuGet Package</a> install from within Visual Studio using the NuGet Package Manager.</p>

<p>Please, if you like TiraggoEdmx spread the word via Twitter or your Blog ...</p>

<hr><p>TiraggoEdmx is a metadata engine that is capable of serving up all of the data in your EDMX file(s). This includes the mappings between your conceptual columns and physical database columns. You can get the low level SQL information and data types. EDMX versions 2 and 3 are both supported. Typically version 2 is created using VS2010 and version 3 is created using VS2012.</p>

<p>There is a Windows.Forms sample you can run in the TiraggoEdmx github repository, it's a great way to set a break point and examine the metadata by expanding the "edmx" class in the debugger.</p>

<p>Let's take a look at how you use the 'TiraggoEntityInfo' class.</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// Typical T4 Toolbox Classes Here</span>
<span class="n">MetadataLoader</span> <span class="n">loader</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MetadataLoader</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="n">EdmItemCollection</span> <span class="n">items</span> <span class="p">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">CreateEdmItemCollection</span><span class="p">(</span><span class="n">inputFile</span><span class="p">);</span>

<span class="c1">// TiraggoEdmx code now ...</span>
<span class="n">Edmx</span> <span class="n">edmx</span> <span class="p">=</span> <span class="n">Edmx</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="s">@"Model1.edmx"</span><span class="p">);</span>

<span class="c1">// We use the loader to get the entity names in our .edmx</span>
<span class="k">foreach</span> <span class="p">(</span><span class="n">EntityType</span> <span class="n">e</span> <span class="k">in</span> <span class="n">items</span><span class="p">.</span><span class="n">GetItems</span><span class="p">&lt;</span><span class="n">EntityType</span><span class="p">&gt;().</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">Name</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// Everthing you need including your low level SQL metadata types</span>
    <span class="n">TiraggoEntityInfo</span> <span class="n">info</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TiraggoEntityInfo</span><span class="p">(</span><span class="n">edmx</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span>

    <span class="kt">string</span> <span class="n">schema</span> <span class="p">=</span> <span class="n">info</span><span class="p">.</span><span class="n">StorageInfo</span><span class="p">.</span><span class="n">Schema</span><span class="p">;</span>  <span class="c1">// dbo</span>
    <span class="kt">string</span> <span class="n">table</span> <span class="p">=</span> <span class="n">info</span><span class="p">.</span><span class="n">StorageInfo</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>     <span class="c1">// Employees</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="n">tgProperty</span> <span class="n">prop</span> <span class="k">in</span> <span class="n">info</span><span class="p">.</span><span class="n">ConceptualModel</span><span class="p">.</span><span class="n">Properties</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// prop.Name is conceptual name, let's get the physical name</span>
        <span class="kt">string</span> <span class="n">physicalColumName</span> <span class="p">=</span> <span class="n">info</span><span class="p">.</span><span class="n">ColumnMappings</span><span class="p">[</span><span class="n">prop</span><span class="p">.</span><span class="n">Name</span><span class="p">];</span>

        <span class="c1">// Let's now get the low level SQL info using the physical name</span>
        <span class="n">tgProperty</span> <span class="n">sqlInfo</span> <span class="p">=</span> <span class="n">info</span><span class="p">.</span><span class="n">ColumnSQL</span><span class="p">[</span><span class="n">physicalColumName</span><span class="p">];</span>

        <span class="c1">// Now we have the low level SQL Information</span>
        <span class="kt">string</span> <span class="n">s1</span> <span class="p">=</span> <span class="n">sqlInfo</span><span class="p">.</span><span class="n">Type</span><span class="p">;</span> <span class="c1">// nvarchar, datetime, ...</span>
        <span class="kt">string</span> <span class="n">s2</span> <span class="p">=</span> <span class="n">sqlInfo</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span> <span class="c1">// physical column name</span>
        <span class="c1">// and so on with many more properties on sqlInfo ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>After installing TiraggoEdmx you will have two sample T4 templates installed in your "Models" folder. One is for V2 edmx files and the other is for V3 edmx files. They will both run fine, however, only one will generate code (depending on which version of edmx files you're using).</p>

<p>The TiraggoEdmx sample templates generate simple classes and are only meant to show you how to use the metadata and more specifically how to the underlying low level information very easily. The classes generated will look something like this. Keep in the mind the comments in the class below were also generated via the template.</p>

<div class="highlight highlight-csharp"><pre><span class="k">namespace</span> <span class="nn">MyNamespace.Models.TiraggoEdmx</span>
<span class="p">{</span>
    <span class="c1">// Physical Table [dbo.CollaboratorInvite]</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">CollaboratorInvite</span>
    <span class="p">{</span>
        <span class="c1">// Physical SQL Column [Id], Type [uniqueidentifier]</span>
<span class="na">        [Key]</span>
<span class="na">        [Required]</span>
        <span class="k">public</span> <span class="n">Guid</span> <span class="n">MemberId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// Physical SQL Column [CollborationKey], Type [nvarchar]</span>
<span class="na">        [Key]</span>
<span class="na">        [Required]</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">CollborationKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// Physical SQL Column [RepositoryId], Type [uniqueidentifier]</span>
<span class="na">        [Required]</span>
        <span class="k">public</span> <span class="n">Guid</span> <span class="n">RepositoryId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// Physical SQL Column [InviteeId], Type [uniqueidentifier]</span>
<span class="na">        [Required]</span>
        <span class="k">public</span> <span class="n">Guid</span> <span class="n">InviteeId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// Physical SQL Column [DateCreatedOn], Type [datetime]</span>
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">CreatedOn</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a href="http://brewdawg.github.io/Tiraggo.EF/">Tiraggo.EF</a> which creates the Tiraggo Dynamic Query classes uses the TiraggoEdmx metadata library for it's T4 code generation needs. </p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>